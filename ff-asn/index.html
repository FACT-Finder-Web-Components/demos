<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ASN Demo</title>
    <link rel="stylesheet" href="../assets/demo-styles.css">

    <script>
        document.addEventListener('ffReady', ({resultDispatcher}) => {
            resultDispatcher.subscribe('asn', addRatingInfo);
        });

        function addRatingInfo(groups) {
            if (!groups) return;

            groups.filter(group => group.name === "Rating").forEach(group => {
                group.elements.concat(group.selectedElements).forEach(el => {
                    const offset = el.name.match(/^< \d/) ? -1 : 0;
                    const rating = parseInt(el.name.match(/\d+(\.\d+)?/g)[0]) + offset;
                    el._stars = ratingToStars(rating);
                });
            });

            function ratingToStars(rating) {
                return Array.from({length: 5}, (_, i) => ({
                    class: i < rating ? "star-bright" : "star-dim"
                }));
            }
        }
    </script>

    <script src="../node_modules/ff-web-components/dist/vendor/custom-elements-es5-adapter.js"></script>
    <script src="../node_modules/ff-web-components/dist/vendor/webcomponents-loader.js"></script>
    <script defer src="../node_modules/ff-web-components/dist/bundle.js"></script>

    <style>
        main {
            display: flex;
            padding: 0 10px;
        }
        .filters {
            flex: 0 0;
            width: 240px;
            margin-right: 10px;
        }
        .products-listing {
            flex: 1 0;
        }

        ff-record-list {
            margin-right: -10px;
        }
    </style>
</head>
<body>
<ff-communication
        url="https://showcase.ff-labs.de/fact-finder"
        version="ng"
        channel="Bergfreunde-en"

        currency-code="EUR"
        currency-country-code="de-DE"

        default-query="boots"
        search-immediate

        disable-single-hit-redirect="true"
></ff-communication>

<div class="searchbar">
    <ff-searchbox use-suggest="false">
        <input placeholder="Search..." autofocus />
        <ff-searchbutton>
            <button>
                <span class="icon-search"></span>
            </button>
        </ff-searchbutton>
    </ff-searchbox>
</div>

<main>
    <div class="filters">
        <ff-asn-remove-all-filter>Reset all filters</ff-asn-remove-all-filter>
        <ff-asn unresolved>

            <ff-asn-group for-group="all">
                <ff-asn-group-element>
                    <div slot="selected">
                        <span class="checkbox"></span> {{element.name}}&nbsp;{{group.unit}}
                    </div>

                    <div slot="unselected">
                        <span class="checkbox"></span>
                        <span>{{element.name}}&nbsp;{{group.unit}}</span>
                        <span>({{element.recordCount}})</span>
                    </div>
                </ff-asn-group-element>

                <div slot="groupCaption" class="expand-arrow"><div>{{group.name}}</div></div>

                <div data-container="detailedLinks">
                    <div data-content="detailedLinks"></div>
                </div>

                <div data-container="hiddenLinks">
                    <div data-content="hiddenLinks"></div>
                </div>

                <div data-container="removeFilter">[x] Reset Filter</div>
            </ff-asn-group>

            <ff-asn-group filter-style="TREE" collapsible="false" opened>
                <ff-asn-group-element>
                    <div slot="selected">{{element.name}}&nbsp;{{group.unit}}</div>
                    <div slot="unselected">
                        <p>{{element.name}}&nbsp;{{group.unit}} <span class="count">({{element.recordCount}})</span>
                        </p>
                    </div>
                </ff-asn-group-element>

                <div slot="groupCaption"><div>{{group.name}}</div></div>

                <div data-container="removeFilter">[x] Reset Filter</div>
            </ff-asn-group>

            <ff-asn-group filter-style="DEFAULT">
                <ff-asn-group-element>
                    <div slot="selected">
                        <span class="circle"></span> {{element.name}}&nbsp;{{group.unit}}
                    </div>

                    <div slot="unselected">
                        <span class="circle"></span>
                        <span>{{element.name}}&nbsp;{{group.unit}}</span>
                        <span>({{element.recordCount}})</span>
                    </div>
                </ff-asn-group-element>

                <div slot="groupCaption" class="expand-arrow"><div>{{group.name}}</div></div>

                <div data-container="detailedLinks">
                    <div data-content="detailedLinks"></div>
                </div>
                <div data-container="hiddenLinks">
                    <div data-content="hiddenLinks"></div>
                </div>

                <div data-container="removeFilter">[x] Reset Filter</div>
            </ff-asn-group>

            <ff-asn-group-slider for-group="Price" class="one-touch-slider" opened>
                <div slot="groupCaption" class="expand-arrow"><div>{{group.name}}</div></div>

                <div data-container="removeFilter">[x] Reset Filter</div>

                <ff-slider-control submit-on-input="true">
                    <div class="slider-inputs">
                        <input data-control='1'
                               ssstyle="position: absolute; left: 15px;top:12px;">
                        <input data-control='2'
                               ssstyle="position: absolute; right: 15px;top:12px;">
                    </div>

                    <ff-slider-one-touch></ff-slider-one-touch>
                </ff-slider-control>
            </ff-asn-group-slider>

            <ff-asn-group for-group="Rating">
                <ff-asn-group-element>
                    <div slot="selected">
                        <span class="checkbox"></span>
                        <span class="stars">
                            {{#element._stars}}<span class="{{class}}">★</span>{{/element._stars}}
                        </span>
                    </div>

                    <div slot="unselected">
                        <span class="checkbox"></span>
                        <span class="stars">
                            {{#element._stars}}<span class="{{class}}">★</span>{{/element._stars}}
                        </span>
                        <span class="count">({{element.recordCount}})</span>
                    </div>
                </ff-asn-group-element>

                <div slot="groupCaption" class="expand-arrow"><div>{{group.name}}</div></div>

                <div data-container="detailedLinks">
                    <div data-content="detailedLinks"></div>
                </div>

                <div data-container="hiddenLinks">
                    <div data-content="hiddenLinks"></div>
                </div>

                <div data-container="removeFilter">[x] Reset Filter</div>
            </ff-asn-group>

            <ff-asn-group-slider>
                <div slot="groupCaption" class="expand-arrow"><div>{{group.name}}</div></div>

                <div data-container="removeFilter">[x] Reset Filter</div>

                <ff-slider-control submit-on-input="true">
                    <input data-control='1'
                           style="position: absolute; left: 15px;top:12px;">
                    <input data-control='2'
                           style="position: absolute; right: 15px;top:12px;">

                    <ff-slider current-min-value="0">
                        <div slot="slider1"></div>
                        <div slot="slider2"></div>
                    </ff-slider>
                </ff-slider-control>
            </ff-asn-group-slider>

        </ff-asn>
    </div>
    <div class="products-listing">
        <ff-record-list unresolved>
            <ff-record>
                <a data-anchor="https://www.alpinetrek.co.uk{{record.Deeplink}}"
                   data-redirect="https://www.alpinetrek.co.uk{{record.Deeplink}}" data-redirect-target="_blank">
                    <div class="record-img">
                        <img data-image="https://showcase.ff-labs.de/demoshop-images/{{record.ImageName}}">
                    </div>
                    <div class="record-product-info">
                        <h3 class="record-product-name">
                            {{record.Title}}
                        </h3>
                        <div class="record-product-brand">{{record.Manufacturer}}</div>
                        <div class="record-product-price">{{record.Price}}</div>
                    </div>
                </a>
                <div class="record-product-add-to-cart">
                    <button>Add to Cart</button>
                </div>
            </ff-record>
        </ff-record-list>
    </div>
</main>
</body>
</html>
