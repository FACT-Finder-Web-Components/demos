<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Secondary Channel Demo - Separate Lists</title>
    <link rel="stylesheet" href="../demo-styles.css">

    <script>
        document.addEventListener(`ffCoreReady`, ({ factfinder }) => {
            const defs = factfinder.config.defaults.general;

            defs.url = `https://showcase.ff-labs.de/fact-finder`;
            defs.channel = `Bergfreunde-en`;


            factfinder.request.before.search(info => {
                factfinder.request.search(info.searchParams, {
                    requestOptions: {
                        channel: `Bergfreunde-de`,

                        // Prevent the result from being automatically dispatched to subscribers.
                        // We are populating the second record-list manually.
                        requestOnly: true,

                        // IMPORTANT: Request to secondary channel must not trigger the before.search handler again to prevent an infinite loop.
                        skipBeforeHandlers: true,
                    },

                    // Opting out of unused data to optimize response time and bandwidth usage.
                    searchControlParams: {
                        useAsn: false,
                        useCampaigns: false,
                    },
                }).then(searchResult => {
                    // Populating the second record list with the result from the secondary channel.
                    document.querySelector(`#right-list`).records = searchResult.hits;
                });
            });

            factfinder.request.search({ query: `shirt` }, { requestOptions: { origin: `searchImmediate` } });
        });
    </script>

    <script src="../node_modules/ff-web-components/dist/vendor/custom-elements-es5-adapter.js"></script>
    <script src="../node_modules/ff-web-components/dist/vendor/webcomponents-loader.js"></script>
    <script defer src="../node_modules/ff-web-components/dist/bundle.js"></script>

    <style>
        body {
            width: 1000px;
        }
        #main {
            display: flex;
            justify-content: space-between;
        }
        #main > div {
            flex-grow: 0;
            flex-shrink: 0;
            width: 46%;
            box-sizing: border-box;
        }
    </style>
</head>

<body>

<div id="search-controls">
    <ff-searchbox use-suggest="false">
        <input placeholder="Search..." autofocus>
        <ff-searchbutton>
            <button>Search</button>
        </ff-searchbutton>
    </ff-searchbox>
</div>

<div id="main">
    <div id="left">
        <ff-record-list>
            <ff-record>
                <div><img data-image="{{variantValues.0.ImageURL}}"></div>
                <div>{{variantValues.0.Title}}</div>
                <div>{{variantValues.0.Price}}</div>
            </ff-record>
        </ff-record-list>
    </div>
    <div id="right">
        <ff-record-list id="right-list" subscribe="false">
            <ff-record>
                <div><img data-image="{{variantValues.0.ImageURL}}"></div>
                <div>{{variantValues.0.Title}}</div>
                <div>{{variantValues.0.Price}}</div>
            </ff-record>
        </ff-record-list>
    </div>
</div>

</body>
</html>
